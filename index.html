<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Guess 4 groups of 4 items in Isaac. Changes everyday !">
    <link rel="icon" href="/assets/isaaconnect.ico" type="image/x-icon">
    <title>Isaaconnect</title>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-WJ5LN7PH');</script>
    <!-- End Google Tag Manager -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body.blackout {
            background-color: black;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
    </style>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/themes.css">
</head>
<body class="theme">
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WJ5LN7PH"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    
    <div class="flex flex-col h-full">
        <div class="flex flex-row justify-center items-center margin-0 mx-auto flex-wrap md:flex-nowrap flex-1">

            <div class="flex flex-col">

                <div id="title" class="flex self-center">
                    <h1 class="upheaval text-5xl md:text-6xl shadow-theme text-white flex">ISAA<span>CONNECT</span></h1>
                </div>

                <div class="flex flex-row justify-center">
                    <div  class="shadow-theme flex flex-col justify-center items-center p-4 m-4 mb-0 text-center bg-paper rounded-3xl" id="cards-game">
                        <div id="cards-win">
                            <ol class="solved-groups">
                                
                            </ol>
                        </div>
                        <div id="cards-module" class="cards-module grid grid-cols-4 gap-4">
                        </div>
                        <div id="modal-wrapper" style="display: none;" class="z-10">

                        </div>
                    </div>
                    <div class="message flex absolute px-4 py-2 rounded-2xl hidden">
                        Bonjour
                    </div>
                </div>

                <section class="buttons flex flex-col-reverse md:flex-row justify-center md:justify-evenly gap-4 mt-4">
                    <div class="flex justify-evenly">
                        <button type="button" data-id="shuffle" class="shadow-theme text-dark font-bold py-2 px-4 themed rounded-xl button--shuffle block md:hidden">
                            Shuffle
                        </button>
                        <button type="button" data-id="submit" class="shadow-theme text-dark font-bold py-2 px-4 rounded-xl button--submit button--disabled" disabled>
                            Submit
                        </button>
                    </div>
                    <section class="health flex justify-center md:justify-between upheaval">
                        <span class="flex ml-2 items-between hearts">
                        </span>
                    </section>
                </section>
            </div>

            <div class="flex-col gap-4 items-center hidden md:flex">
                <button type="button" data-id="shuffle" class="shadow-theme themed text-white font-bold p-3 rounded-full">
                    <span class="material-symbols-outlined align-bottom">
                        shuffle
                        </span>
                </button>
            </div>
        </div>

        
        <div class="flex flex-col relative md:fixed">
            <div id="tooltip-wrapper" class="bottom-20 md:top-20 max-w-sm md:max-w-md xl:max-w-lg" style="display: none"></div>
            <div id="tooltip-icons" class="flex flex-row bottom align-bottom text-white  symbol-fill gap-6 md:gap-2 justify-center md:justify-start">
                <span class="material-symbols-rounded md:text-4xl" onclick="displayTooltip(this);" data-id="stats">
                    bar_chart
                </span>
                <span class="material-symbols-rounded md:text-4xl" onclick="displayTooltip(this);" data-id="schedule">
                    schedule
                </span>
                <span class="material-symbols-rounded md:text-4xl">
                    diversity_1
                </span>
                <span class="material-symbols-rounded md:text-4xl" onclick="displayTooltip(this);" data-id="help">
                    help
                </span>
                <span class="material-symbols-rounded md:text-4xl" onclick="displayTooltip(this);" data-id="settings">
                    settings
                </span>
            </div>
        </div>
    </div>
</body>

<script src="//cdnjs.cloudflare.com/ajax/libs/seedrandom/3.0.5/lib/alea.min.js"></script>
<script type="module" src="/js/index.js"></script>
<script>
    function numberWithLeadingZeros(number, length = 3)
    {
        while (number.toString().length < length)
        {
            number = '0' + number;
        }

        return number;
    }

    function changeBackground(element)
    {
        let body = document.querySelector('body');
        const regex = new RegExp('(.*-theme)', 'g');
        if (body.className.match(regex))
        {
            body.className = body.className.replace(regex, '');
        }

        let theme = element.value;

        if (element.value === 'void-theme')
        {
            let selectElement = document.querySelector('[name=background]');
            let optionValues = [...selectElement.options].map(o => o.value)
            let randomValue = optionValues[Math.floor(Math.random() * optionValues.length)];
            theme = randomValue;
            element.selected = false;
            let randomElement = document.querySelector(`option[value="${randomValue}"]`);
            randomElement.checked = true;
        }

        localStorage.setItem('theme', element.value);
        body.classList.add(theme);
    }

    function changeAutocompletion(element)
    {
        let autocomplete = localStorage.getItem('autocomplete');
        let checkbox = document.querySelector('#autocomplete');
        if (autocomplete === 'true')
        {
            localStorage.setItem('autocomplete', 'false');
            checkbox.parentNode.classList.remove('tgl-checked');
        }
        else
        {
            localStorage.setItem('autocomplete', 'true');
            checkbox.parentNode.classList.add('tgl-checked');
        }
    }

    function changeDifficulty(element)
    {
        let difficulty = localStorage.getItem('difficulty');
        let checkbox = document.querySelector('#difficulty');
        let cards = document.querySelectorAll('.card-module--content');
        if (difficulty === 'easy')
        {
            localStorage.setItem('difficulty', 'normal');
            checkbox.parentNode.classList.remove('tgl-checked');

            cards.forEach(card => {
                card.classList.add('hidden');
            });
        }
        else
        {
            localStorage.setItem('difficulty', 'easy');
            checkbox.parentNode.classList.add('tgl-checked');
            cards.forEach(card => {
                card.classList.remove('hidden');
            });
        }
    }

    function removeLocalStorage()
    {
        localStorage.clear();
    }

    function copyResult(element)
    {
        const title = document.querySelector('[data-id="results--title"]');
        const results = document.querySelector('[data-id="results"]');
        try
        {
            let textToCopy = "";
            // textToCopy = title.textContent + "\n";

            let health = localStorage.getItem('health');
            if (health === undefined)
            {
                health = document.querySelectorAll('[data-type="health"]').length;
            }
            textToCopy += `‚ù§Ô∏è: ${health} üíî: ${4 - health}\n`;
            
            for (let i = 0; i < 5; i++)
            {
                let items = document.querySelectorAll(`[data-id^="results-attempt${i}-"]`);
                items.forEach(item => {
                    let indexGroup = + item.getAttribute('data-id').split('-group')[1];
                    switch (indexGroup)
                    {
                        case 0:
                            textToCopy += "üü•";
                            break;
                        case 1:
                            textToCopy += "üü¶";
                            break;
                        case 2:
                            textToCopy += "üü©";
                            break;
                        case 3:
                            textToCopy += "üü™";
                            break;
                    }
                });
                textToCopy += "\n";
            }
            let moreRows = results.length - 4;
            if (moreRows > 0)
            {
                textToCopy += `... and ${moreRows} more rows\n`;
            }

            navigator.clipboard.writeText(textToCopy);
            element.innerHTML = `<span class="material-symbols-outlined align-bottom">check</span>Copied!`;
            setTimeout(() => {
                element.innerHTML = `<span class="material-symbols-outlined align-bottom">content_copy</span>Copy`;
            }, 2500);
        }
        catch (error)
        {
            alert("Failed to copy to clipboard");
        }
        
    }
</script>
<script>
    function getTimeRemaining() {
        const now = new Date();
        const target = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1, 8, 0, 0, 0);
        const timeRemaining = target - now;
        
        const seconds = Math.floor((timeRemaining / 1000) % 60);
        const minutes = Math.floor((timeRemaining / 1000 / 60) % 60);
        const hours = Math.floor((timeRemaining / (1000 * 60 * 60)) % 24);
        
        return {
            total: timeRemaining,
            hours: hours,
            minutes: minutes,
            seconds: seconds
        };
    }
    
    function updateCountdown() {
        const countdownElement = document.querySelectorAll('.countdown');
        
        const timeRemaining = getTimeRemaining();
        
        countdownElement.forEach(element => {
            element.textContent = `${numberWithLeadingZeros(timeRemaining.hours, 2)} : ${numberWithLeadingZeros(timeRemaining.minutes, 2)} : ${numberWithLeadingZeros(timeRemaining.seconds, 2)}`;
        });
        
        if (timeRemaining.total <= 0) {
            clearInterval(countdownInterval);
            location.reload();
        }
    }
    
    const countdownInterval = setInterval(updateCountdown, 1000);
</script>
<script>
    (function() {
        const sequence = [52, 56, 49, 53, 49, 54, 50, 51, 52, 50]; // Codes des touches 4, 8, 15, 16, 23, 42
        let position = 0;

        document.addEventListener('keydown', (event) => {
            if (event.keyCode === sequence[position]) {
                position++;
                if (position === sequence.length) {
                    localStorage.clear();
                    document.body.classList.add('blackout');
                    setTimeout(() => {
                        prompt("Vous avez appuy√© sur la s√©quence correcte !");
                    }, 500);
                }
            } else {
                position = 0;
            }
        });
    })();
</script>
<script>
    function displayTooltip(element)
    {
        let wrapper = document.querySelector('#tooltip-wrapper');
        let type = element.getAttribute('data-id');
        wrapper.style.display = 'none';
        let isAlreadyActive = document.querySelector('.tooltip-active');
        if (wrapper.innerHTML !== '')
        {
            wrapper.innerHTML = '';
            document.querySelectorAll('.tooltip-active').forEach(element => {
                element.classList.remove('tooltip-active');
                element.classList.add('tooltip-inactive');
                element.classList.remove('shadow-theme');
            });
        }
        
        if (isAlreadyActive != null && isAlreadyActive.getAttribute('data-id') === type)
        {
            isAlreadyActive.classList.remove('tooltip-active');
            isAlreadyActive.classList.add('tooltip-inactive');
            isAlreadyActive.classList.remove('shadow-theme');
            return;
        }

        wrapper.style.display = 'block';

        element.classList.add('tooltip-active');
        element.classList.add('shadow-theme');
        element.classList.remove('tooltip-inactive');

        switch (type)
        {
            case 'stats':
                wrapper.innerHTML = statsHtml();
                break;
            case 'help':
                wrapper.innerHTML = helpHtml();
                break;
            case 'settings':
                wrapper.innerHTML = settingsHtml();
                let theme = localStorage.getItem('theme');
                document.querySelectorAll('option').forEach(option => { option.selected = false; });
                document.querySelector('option[value="' + theme + '"]').selected = true;
                let autocomplete = localStorage.getItem('autocomplete');
                if (autocomplete == 'true')
                {
                    let checkbox = document.querySelector('#autocomplete');
                    checkbox.checked = true;
                    checkbox.parentNode.classList.add('tgl-checked');
                }

                let difficulty = localStorage.getItem('difficulty');
                if (difficulty == 'easy')
                {
                    let checkbox = document.querySelector('#difficulty');
                    checkbox.checked = true;
                    checkbox.parentNode.classList.add('tgl-checked');
                }
                break;
            case 'schedule':
                wrapper.innerHTML = scheduleHtml();
                break;
            default:
                break;
        }

        wrapper.setAttribute('data-id', type);
    }

    function settingsHtml()
    {
        let attempt = localStorage.getItem('currentAttempt');
        return `
            <div class="rounded-2xl tooltip shadow-theme" data-id="settings">
                <div class="tooltip-content">
                    <div class="flex flex-col gap-4">
                        <h1 class="text-2xl">Settings</h1>
                        <p>Here you can choose some settings for the website, like the theme, autocomplete the fourth group, etc.</p>
                        
                        <div class="flex flex-col theme-selection">
                            <h1 class="text-xl">Theme</h1>
                            <label>
                                <select name="background" onchange="changeBackground(this);" class="rounded-3xl font-semibold">
                                    <option value="main-theme">Main theme</option>
                                    <option value="purple-theme">Mausoleum</option>
                                    <option value="blue-theme">Flooded Caves</option>
                                    <option value="green-theme">Dross</option>
                                    <option value="brown-theme">Poop</option>
                                    <option value="ph-theme">Dark & Orange</option>
                                    <option value="gray-theme">Gray</option>
                                    <option value="downpour-theme">Downpour</option>
                                    <option value="red-theme">Red</option>
                                    <option value="womb-theme">Womb</option>
                                    <option value="classic-theme">Classic</option>
                                    <option value="dave-theme">Dave</option>
                                    <option value="corpse-theme">Corpse</option>
                                    <option value="cathedral-theme">Cathedral</option>
                                    <option value="sheol-theme">Sheol</option>
                                    <option value="chest-theme">Chest</option>
                                    <option value="dark-room-theme">Dark Room</option>
                                    <option value="void-theme">The Void</option>
                                </select>
                            </label>
                        </div>
                        <div class="flex flex-row-reverse gap-4 justify-center">
                            <h1 class="text-xl">Autocomplete</h1>
                            <div class="checkbox-wrapper rounded-3xl">
                                <input onchange="changeAutocompletion(this)" class="tgl tgl-theme" id="autocomplete" type="checkbox"/>
                                <label class="tgl-btn" for="autocomplete">
                            </div>
                        </div>
                        ${attempt == null ? `<div class="flex flex-row-reverse gap-4 justify-center" data-id="difficulty">
                            <h1 class="text-xl">Easy mode</h1>
                            <div class="checkbox-wrapper rounded-3xl">
                                <input onchange="changeDifficulty(this)" class="tgl tgl-theme" id="difficulty" type="checkbox"/>
                                <label class="tgl-btn" for="difficulty">
                            </div>` : ''}
                    </div>
                </div>
            </div>
        `;
    }

    function helpHtml()
    {
        return `
            <div class="tooltip shadow-theme rounded-2xl" data-id="help">
                <div class="tooltip-content text-justify">
                    <h1 class="text-3xl text-center">Create <b>4 groups</b> of <b>4 items !</b></h1><br>
                    <p>In Isaaconnect, you have to form groups of items that have something in common. There are four groups, some are easier that others.</p>
                    <p>Don't make too many mistakes !</p>
                    <br>
                    <p>Made with love by D√©morck. Inspired by <b>Only Connect</b> and <b>NYT Connections.</b> Website design by Biobak.</p>
                </div>
            </div>
        `;
    }

    function scheduleHtml()
    {
        return `
            <div class="tooltip shadow-theme rounded-2xl min-w-xs maw-w-xs" data-id="schedule">
                <div class="tooltip-content px-5 py-4">
                    <h1 class="text-2xl">Next Isaaconnect in</h1>
                    <p class="upheaval countdown text-6xl">00 : 00 : 00</p>
                </div>
            </div>
        `;
    }

    function statsHtml()
    {
        return `
            <div class="tooltip shadow-theme rounded-2xl min-w-xs maw-w-xs" data-id="schedule">
                <div class="tooltip-content px-5 py-4">
                    <h1 class="text-2xl font-bold">Isaaconnect #${localStorage.getItem("lastIsaaconnect")}</h1>
                    <div class="flex flex-col">
                        <div class="flex flex-row gap-4 font-medium"><span class="text-3xl flex self-end">Win Streak</span><span class="text-4xl upheaval flex">${localStorage.getItem("winStreak")}</span></div>
                        <div class="flex flex-row gap-4 font-medium"><span class="text-3xl flex self-end">Longest Streak</span><span class="text-4xl upheaval flex">${localStorage.getItem("longestStreak")}</span></div>
                        <div class="flex flex-row gap-4 font-medium"><span class="text-3xl flex self-end">Total Wins</span><span class="text-4xl upheaval flex">${localStorage.getItem("wins")}</span></div>
                        <div class="flex flex-row gap-4 font-medium"><span class="text-3xl flex self-end">Total losses</span><span class="text-4xl upheaval flex">${localStorage.getItem("losses")}</span></div>
                    </div>
                </div>
            </div>
        `;
    }
</script>
</html>